<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Create grid directly on disk (low memory usage) • gridmaker</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="grid-to-disk_files/libs/quarto-html/popper.min.js"></script><script src="grid-to-disk_files/libs/quarto-html/tippy.umd.min.js"></script><link href="grid-to-disk_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="grid-to-disk_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create grid directly on disk (low memory usage)">
<meta property="og:image" content="http://www.ekotov.pro/gridmaker/reference/figures/card.png">
<meta property="og:image:alt" content="gridmaker: Create INSPIRE-compliant grids with IDs">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@EgorKotov">
<meta name="twitter:site" content="@EgorKotov">
<!-- counter.dev analytics --><script data-goatcounter="https://jukadipos.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script><!-- counter.dev analytics --><script src="https://cdn.counter.dev/script.js" data-id="7e3e8d31-9a84-48b0-a678-a00715236a90" data-utcoffset="1"></script><script>
 (function(h,o,t,j,a,r){
     h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
     h._hjSettings={hjid:3578286,hjsv:6};
     a=o.getElementsByTagName('head')[0];
     r=o.createElement('script');r.async=1;
     r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
     a.appendChild(r);
 })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gridmaker</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/gridmaker.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Get Started</h6></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/grid-to-disk.html">Create grid directly on disk (low memory usage)</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/e-kotov/gridmaker/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Create grid directly on disk (low memory usage)</h1>




      <small class="dont-index">Source: <a href="https://github.com/e-kotov/gridmaker/blob/main/vignettes/grid-to-disk.qmd" class="external-link"><code>vignettes/grid-to-disk.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/e-kotov/gridmaker" class="external-link">gridmaker</a></span><span class="op">)</span></span></code></pre></div>
</div>
<section class="section level2"><h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>When creating high-resolution grids for large areas, memory constraints can become a significant challenge. The <a href="https://github.com/e-kotov/gridmaker" class="external-link">gridmaker</a> package provides a disk-based streaming approach that allows you to create grids directly on disk without loading the entire grid into memory. This is particularly useful when:</p>
<ul>
<li>Creating grids with millions of cells (e.g., 100m grid for Spain) that would exceed available RAM</li>
<li>You want to save the grid to disk for later use anyway, avoiding the need to keep it in memory</li>
<li>Working on memory-constrained systems where keeping large objects in RAM is not feasible (the aformentioned 100m grid for Spain would require over 100 GB of RAM if created in memory, but only about 4 GB of peak memory when using the disk-based approach)</li>
</ul>
<p>The disk-based approach uses the <code>dsn</code> parameter in <code><a href="../reference/inspire_grid.html">inspire_grid()</a></code> to write grid chunks sequentially to a file as they are generated, keeping memory usage low and constant regardless of the final grid size.</p>
</section><section class="section level2"><h2 id="example-create-a-100m-grid-for-spain">Example: Create a 100m grid for Spain<a class="anchor" aria-label="anchor" href="#example-create-a-100m-grid-for-spain"></a>
</h2>
<p>This example demonstrates creating a high-resolution 100m grid covering Spain, which generates millions of grid cells. Without the disk-based approach, this would require substantial memory.</p>
<section class="level2"><h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<p>We will use <code>giscoR</code> package to get the boundary of Spain. If you don’t have it installed, you can install it from CRAN with <code>install.packages("giscoR")</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("giscoR")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ropengov.github.io/giscoR/" class="external-link">giscoR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level2"><h3 id="get-the-country-boundary">Get the country boundary<a class="anchor" aria-label="anchor" href="#get-the-country-boundary"></a>
</h3>
<p>Let’s get the boundary of Spain in ETRS89-LAEA (EPSG:3035):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spain_boundary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ropengov.github.io/giscoR/reference/gisco_get_countries.html" class="external-link">gisco_get_countries</a></span><span class="op">(</span></span>
<span>  year <span class="op">=</span> <span class="st">"2024"</span>,</span>
<span>  epsg <span class="op">=</span> <span class="st">"3035"</span>,</span>
<span>  country <span class="op">=</span> <span class="st">"Spain"</span>,</span>
<span>  resolution <span class="op">=</span> <span class="st">"01"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">spain_boundary</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level2"><h3 id="create-grid-directly-to-geopackage">Create grid directly to GeoPackage<a class="anchor" aria-label="anchor" href="#create-grid-directly-to-geopackage"></a>
</h3>
<p>Now we can create a 100m grid and write it directly to a GeoPackage file. The function will automatically:</p>
<ul>
<li>Determine optimal chunk size based on available memory</li>
<li>Stream grid chunks sequentially to disk</li>
<li>Keep memory usage low and constant</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spain_grid_100m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspire_grid.html">inspire_grid</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">spain_boundary</span>,</span>
<span>  cellsize_m <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  output_type <span class="op">=</span> <span class="st">"sf_polygons"</span>,</span>
<span>  dsn <span class="op">=</span> <span class="st">"spain_grid_100m.gpkg"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div>
<blockquote>
<p><strong>Performance Note</strong></p>
<p>Based on benchmark testing, creating a 100m grid for Spain:</p>
<ul>
<li>
<strong>Total cells</strong>: ~15 million polygons</li>
<li>
<strong>Processing time</strong>: ~4.3 hours (15,476 seconds)</li>
<li>
<strong>Chunk size</strong>: 40 rows per chunk (382 chunks total) (determined automatically)</li>
<li>
<strong>Memory usage</strong>: Low and constant just under 4 GB (determined by chunk size)</li>
</ul>
<p>The processing is done sequentially when no parallel backend is detected, streaming chunks directly to disk.</p>
</blockquote>
</div>
</section><section class="level2"><h3 id="create-grid-directly-to-geotiff-raster">Create grid directly to GeoTIFF (raster)<a class="anchor" aria-label="anchor" href="#create-grid-directly-to-geotiff-raster"></a>
</h3>
<p>Raster grid creation also supports chunked streaming to disk via the <code>terra</code> backend. This follows a similar logic to vector output, where the grid is generated and written in blocks to minimize memory usage.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># By default, rasters are written without a Raster Attribute Table (RAT)</span></span>
<span><span class="co"># for maximum performance.</span></span>
<span><span class="va">spain_grid_100m_raster</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspire_grid.html">inspire_grid</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">spain_boundary</span>,</span>
<span>  cellsize_m <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  output_type <span class="op">=</span> <span class="st">"spatraster"</span>,</span>
<span>  dsn <span class="op">=</span> <span class="st">"spain_grid_100m.tiff"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<section class="level3"><h4 id="raster-attribute-tables-rat">Raster Attribute Tables (RAT)<a class="anchor" aria-label="anchor" href="#raster-attribute-tables-rat"></a>
</h4>
<p>By default, raster outputs contain only numeric cell identifiers. If you need the human-readable INSPIRE IDs (e.g., <code>100mN1234E5678</code>), you can use <code>include_rat = TRUE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Opt-in for RAT generation (slower, creates larger files)</span></span>
<span><span class="fu"><a href="../reference/inspire_grid.html">inspire_grid</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">spain_boundary</span>,</span>
<span>  cellsize_m <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  output_type <span class="op">=</span> <span class="st">"spatraster"</span>,</span>
<span>  dsn <span class="op">=</span> <span class="st">"spain_grid_100m_with_rat.tiff"</span>,</span>
<span>  include_rat <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div>
<blockquote>
<p><strong>Format-Specific RAT Behavior</strong></p>
<p>The storage of Raster Attribute Tables depends on the file format:</p>
<ul>
<li>
<strong>GeoTIFF</strong> (<code>.tif</code>): RAT is stored in an external <code>.aux.xml</code> sidecar file. For large grids, this sidecar can become quite large.</li>
<li>
<strong>NetCDF</strong> (<code>.nc</code>) and <strong>KEA</strong> (<code>.kea</code>): RAT is embedded natively within the file. These are recommended if you require embedded metadata.</li>
<li>
<strong>HDF5</strong>: RAT is currently not supported for this format.</li>
</ul>
</blockquote>
</div>
</section><section class="level3"><h4 id="parallel-generation">Parallel Generation<a class="anchor" aria-label="anchor" href="#parallel-generation"></a>
</h4>
<p>For large raster grids, you can significantly speed up the process by using the <code>mirai</code> parallel backend.</p>
<p><strong>Performance Benefits:</strong> - <strong>mirai</strong>: ~2-3x speedup over sequential execution (with async streaming)</p>
<p>To use parallel generation, simply configure the <code>mirai</code> backend before calling <code><a href="../reference/inspire_grid.html">inspire_grid()</a></code>. The function will automatically detect the backend and switch to parallel mode.</p>
<p><strong>Using <code>mirai</code></strong></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mirai.r-lib.org" class="external-link">mirai</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Start 4 persistent workers (daemons)</span></span>
<span><span class="co"># Benchmarks show 4-8 workers provides optimal performance</span></span>
<span><span class="co"># (&gt;8 workers often yields diminishing returns)</span></span>
<span><span class="fu"><a href="https://mirai.r-lib.org/reference/daemons.html" class="external-link">daemons</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Function automatically detects workers and runs in parallel</span></span>
<span><span class="fu"><a href="../reference/inspire_grid.html">inspire_grid</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">spain_boundary</span>,</span>
<span>  cellsize_m <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  output_type <span class="op">=</span> <span class="st">"spatraster"</span>,</span>
<span>  dsn <span class="op">=</span> <span class="st">"spain_grid_mirai.tif"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Clean up</span></span>
<span><span class="fu"><a href="https://mirai.r-lib.org/reference/daemons.html" class="external-link">daemons</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<div>
<blockquote>
<p><strong>Note on Parallel Backends</strong></p>
<p>Only <code>mirai</code> is supported for parallel raster disk streaming. The <code>future</code> backend is supported for in-memory vector generation but not for raster disk output.</p>
</blockquote>
</div>
</section></section><section class="level2"><h3 id="read-the-grid-from-disk">Read the grid from disk<a class="anchor" aria-label="anchor" href="#read-the-grid-from-disk"></a>
</h3>
<p>Once created, you can read the grid from disk in chunks or subsets to avoid loading everything into memory:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read only the first 1000 features</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="va">grid_subset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="st">"spain_grid_100m.gpkg"</span>, query <span class="op">=</span> <span class="st">"SELECT * FROM grid LIMIT 1000"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or read a spatial subset using a bounding box</span></span>
<span><span class="va">bbox_filter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="fl">4000000</span>, ymin <span class="op">=</span> <span class="fl">3000000</span>,</span>
<span>                          xmax <span class="op">=</span> <span class="fl">4100000</span>, ymax <span class="op">=</span> <span class="fl">3100000</span><span class="op">)</span>,</span>
<span>                        crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="fl">3035</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">grid_spatial_subset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="st">"spain_grid_100m.gpkg"</span>, wkt_filter <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_text.html" class="external-link">st_as_text</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="va">bbox_filter</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</section></section><section class="section level2"><h2 id="controlling-memory-usage">Controlling memory usage<a class="anchor" aria-label="anchor" href="#controlling-memory-usage"></a>
</h2>
<p>The <code><a href="../reference/inspire_grid.html">inspire_grid()</a></code> function automatically determines the optimal chunk size based on <strong>currently available (free) RAM</strong>, not total system memory.</p>
<div>
<blockquote>
<p><strong>Automatic Memory Detection</strong></p>
<p>The automatic mechanism uses <code><a href="https://ps.r-lib.org/reference/ps_system_memory.html" class="external-link">ps::ps_system_memory()</a></code> to check for available free RAM. On shared systems or High Performance Computing (HPC) nodes, this detection might see the total free RAM of the entire node, even if your specific process is allocated a smaller amount. In such cases, the automatic calculation might overestimate available RAM, leading to memory errors.</p>
</blockquote>
</div>
<p>You can control memory usage manually using the <code>max_memory_gb</code> argument:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Manually limit memory usage to 2 GB</span></span>
<span><span class="va">spain_grid_100m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspire_grid.html">inspire_grid</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">spain_boundary</span>,</span>
<span>  cellsize_m <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  output_type <span class="op">=</span> <span class="st">"sf_polygons"</span>,</span>
<span>  dsn <span class="op">=</span> <span class="st">"spain_grid_100m.gpkg"</span>,</span>
<span>  max_memory_gb <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>If you provide <code>max_memory_gb</code>, the function will use this value instead of the automatic detection to calculate how many rows can fit into each chunk.</p>
<p>The function will display information about the calculated chunk size:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sequentially generating and writing 382 chunks ( 40 rows/chunk)...</span></span>
<span><span class="co">#   Note: Memory constraints limited chunk size (max 40 rows/chunk)</span></span></code></pre></div>
<p>If you have more memory available, the function will use larger chunks for better performance. If memory is very constrained, it will use smaller chunks to ensure the process completes successfully.</p>
</section><section class="section level2"><h2 id="output-formats">Output formats<a class="anchor" aria-label="anchor" href="#output-formats"></a>
</h2>
<p>The disk-based approach supports multiple output formats depending on the <code>output_type</code> parameter:</p>
<section class="level2"><h3 id="vector-formats-output_type-sf_polygons-or-sf_points">Vector formats (<code>output_type = "sf_polygons"</code> or <code>"sf_points"</code>)<a class="anchor" aria-label="anchor" href="#vector-formats-output_type-sf_polygons-or-sf_points"></a>
</h3>
<p>Vector grids are written using <code><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">sf::st_write()</a></code> in chunked append mode.</p>
<section class="level3"><h4 id="recommended-formats">Recommended Formats<a class="anchor" aria-label="anchor" href="#recommended-formats"></a>
</h4>
<p><strong>GeoPackage (<code>.gpkg</code>)</strong> - <strong>Primary Recommendation</strong></p>
<p>GeoPackage offers the best balance of speed, cross-platform compatibility, and modern features: - Single-file format (easy to manage and share) - OGC standard with wide software support - Good write performance (baseline reference speed) - No field name length restrictions - No file size limits - Built on SQLite, ensuring data integrity through transactions</p>
<p><strong>GeoParquet (<code>.parquet</code>, <code>.geoparquet</code>)</strong> - <strong>Recommended for Large Grids</strong></p>
<p>GeoParquet is a modern columnar format ideal for analytics and cloud workflows: - Highly efficient columnar storage (smaller files than GeoPackage) - Excellent for large grids and data lake architectures - Native support in modern tools (DuckDB, Arrow, pandas/geopandas) - Fast reads, especially for column-subset queries - Requires sf 1.0+ with GDAL 3.5+</p>
<p><strong>Shapefile (<code>.shp</code>)</strong> - Legacy Alternative</p>
<p>Shapefile remains widely used in GIS and is supported: - <strong>~20% faster writes</strong> than GeoPackage due to non-transactional writes - Universal compatibility with all GIS software - <strong>Limitations:</strong> - Field names limited to 10 characters - Maximum file size of 2 GB - Multi-file format (.shp, .shx, .dbf, .prj) - Lacks support for modern features (timestamps, mixed geometry types)</p>
<p><strong>GeoJSON (<code>.geojson</code>, <code>.json</code>)</strong> - Web/API Use Only</p>
<p>GeoJSON works for chunked writes but has significant performance limitations: - Human-readable JSON format - Web API standard - <strong>~40% the speed</strong> of GeoPackage (2-3x slower than database formats) - <strong>Not recommended for large grids</strong> - performance degrades significantly - Use only for small grids or when JSON format is specifically required</p>
</section><section class="level3"><h4 id="other-supported-formats">Other Supported Formats<a class="anchor" aria-label="anchor" href="#other-supported-formats"></a>
</h4>
<p>The following formats have been tested and confirmed to support append operations: - <strong>GeoJSONSeq</strong> (<code>.geojsonl</code>, <code>.geojsonseq</code>) - Newline-delimited GeoJSON for streaming - <strong>FlatGeobuf</strong> (<code>.fgb</code>) - Cloud-optimized format for HTTP range requests - Additional formats (<code>.sqlite</code>) - see <code><a href="https://r-spatial.github.io/sf/reference/st_drivers.html" class="external-link">sf::st_drivers()</a></code> for full list</p>
<div>
<blockquote>
<p><strong>Format Support</strong></p>
<p>All formats listed are confirmed through empirical testing to support appending, which is required for memory-efficient chunked writes. Other formats may work but will generate a warning.</p>
</blockquote>
</div>
</section><section class="level3"><h4 id="for-text-output">For Text Output<a class="anchor" aria-label="anchor" href="#for-text-output"></a>
</h4>
<p>For plain text output with <code>output_type = "dataframe"</code>: - <strong>CSV</strong> (<code>.csv</code>) - Comma-separated values - <strong>TSV</strong> (<code>.tsv</code>) - Tab-separated values - <strong>TXT</strong> (<code>.txt</code>) - Tab-delimited text file</p>
</section></section><section class="level2"><h3 id="raster-formats-output_type-spatraster">Raster formats (<code>output_type = "spatraster"</code>)<a class="anchor" aria-label="anchor" href="#raster-formats-output_type-spatraster"></a>
</h3>
<p>Raster grids are written using <code><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">terra::writeRaster()</a></code>, which supports:</p>
<ul>
<li>
<strong>GeoTIFF</strong> (<code>.tif</code>, <code>.tiff</code>) - Recommended, widely supported</li>
<li>
<strong>NetCDF</strong> (<code>.nc</code>) - Good for multidimensional data</li>
<li>
<strong>ASCII Grid</strong> (<code>.asc</code>) - Text-based, human-readable</li>
<li>
<strong>ERDAS Imagine</strong> (<code>.img</code>) - Common in remote sensing</li>
<li>And other formats supported by GDAL</li>
</ul>
<div>
<blockquote>
<p><strong>Performance Comparison</strong></p>
<p>Based on benchmark testing with a 100m grid for Spain (~15 million cells):</p>
<ul>
<li>
<strong>Raster output</strong> (GeoTIFF): ~47 minutes (2,842 seconds)</li>
<li>
<strong>Vector output</strong> (GeoPackage): ~4.3 hours (15,476 seconds)</li>
<li>
<strong>Speedup</strong>: Raster is ~5.4x faster than vector</li>
</ul>
<p>Choose raster output when you only need grid cell identifiers and values. Use vector output when you need actual polygon geometries for spatial operations.</p>
</blockquote>
</div>
</section><section class="level2"><h3 id="texttabular-formats-output_type-dataframe">Text/tabular formats (<code>output_type = "dataframe"</code>)<a class="anchor" aria-label="anchor" href="#texttabular-formats-output_type-dataframe"></a>
</h3>
<p>For non-spatial tabular output, the following formats are supported:</p>
<ul>
<li>
<strong>CSV</strong> (<code>.csv</code>) - Comma-separated values</li>
<li>
<strong>TSV</strong> (<code>.tsv</code>) - Tab-separated values</li>
<li>
<strong>TXT</strong> (<code>.txt</code>) - Tab-delimited text file</li>
</ul>
<p>These formats drop the geometry column and write only the attribute data (grid IDs and coordinates).</p>
</section></section><section class="section level2"><h2 id="tips-for-large-grids">Tips for large grids<a class="anchor" aria-label="anchor" href="#tips-for-large-grids"></a>
</h2>
<ol type="1">
<li><p><strong>Use raster output when possible</strong>: If you don’t need polygon geometries, use <code>output_type = "spatraster"</code> for much faster processing.</p></li>
<li><p><strong>Monitor progress</strong>: The function displays a progress bar showing chunk processing status.</p></li>
<li>
<p><strong>Specify layer name</strong>: Use the <code>layer</code> parameter to set a custom layer name in GeoPackage files:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/inspire_grid.html">inspire_grid</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">boundary</span>, cellsize_m <span class="op">=</span> <span class="fl">100</span>,</span>
<span>             dsn <span class="op">=</span> <span class="st">"grid.gpkg"</span>, layer <span class="op">=</span> <span class="st">"my_grid"</span><span class="op">)</span></span></code></pre></div>
</li>
<li><p><strong>File overwriting</strong>: Existing output files will be overwritten with a warning.</p></li>
<li><p><strong>Sequential vs parallel</strong>: The disk-based approach supports parallel streaming using the <code>mirai</code> backend (~2-3x speedup). Only <code>mirai</code> is supported for parallel disk output (both vector and raster); <code>future</code> is only supported for in-memory vector generation.</p></li>
</ol>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p>For original Eurostat’s command line utility to create GISCO grids, see <a href="https://github.com/eurostat/GridMaker" class="external-link">https://github.com/eurostat/GridMaker</a>.</p>
</blockquote>
</div>
</section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.ekotov.pro" class="external-link">Egor Kotov</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
